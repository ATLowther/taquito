(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{101:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return p})),n.d(t,"default",(function(){return b}));var a=n(3),o=n(7),r=(n(0),n(110)),i=n(160),c=n(161),l={title:"TZIP-12 Token Metadata",author:"Roxane Letourneau"},s={unversionedId:"tzip12",id:"tzip12",isDocsHomePage:!1,title:"TZIP-12 Token Metadata",description:"The @taquito/tzip12 package allows retrieving metadata associated with tokens of FA2 contract. More information about the TZIP-12 standard can be found here.",source:"@site/../docs/tzip12.md",slug:"/tzip12",permalink:"/docs/tzip12",version:"current",sidebar:"docs",previous:{title:"TZIP-16 Contract Metadata and Views",permalink:"/docs/metadata-tzip16"},next:{title:"In Memory Signer",permalink:"/docs/inmemory_signer"}},p=[{value:"How to use the tzip12 package",id:"how-to-use-the-tzip12-package",children:[]},{value:"Get the token metadata",id:"get-the-token-metadata",children:[{value:"Example where the token metadata are obtained from an off-chain view <code>token_metadata</code>",id:"example-where-the-token-metadata-are-obtained-from-an-off-chain-view-token_metadata",children:[]},{value:"Example where the token metadata are found in the big map <code>%token_metadata</code>",id:"example-where-the-token-metadata-are-found-in-the-big-map-token_metadata",children:[]}]}],d={toc:p};function b(e){var t=e.components,l=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},d,l,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"@taquito/tzip12")," package allows retrieving metadata associated with tokens of FA2 contract. More information about the TZIP-12 standard can be found ",Object(r.b)("a",{parentName:"p",href:"https://gitlab.com/tzip/tzip/-/blob/master/proposals/tzip-12/tzip-12.md"},"here"),"."),Object(r.b)("h2",{id:"how-to-use-the-tzip12-package"},"How to use the tzip12 package"),Object(r.b)("p",null,"The package can be used as an extension to the well known Taquito contract abstraction. "),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"We first need to create an instance of ",Object(r.b)("inlineCode",{parentName:"strong"},"Tzip12Module")," and add it as an extension to our ",Object(r.b)("inlineCode",{parentName:"strong"},"TezosToolkit")))),Object(r.b)("p",null,"The constructor of the ",Object(r.b)("inlineCode",{parentName:"p"},"Tzip12Module")," takes an optional ",Object(r.b)("inlineCode",{parentName:"p"},"MetadataProvider")," as a parameter. When none is passed, the default ",Object(r.b)("inlineCode",{parentName:"p"},"MetadataProvider")," of Taquito is instantiated and the default handlers (",Object(r.b)("inlineCode",{parentName:"p"},"HttpHandler"),", ",Object(r.b)("inlineCode",{parentName:"p"},"IpfsHandler"),", and ",Object(r.b)("inlineCode",{parentName:"p"},"TezosStorageHandler"),") are used."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},"import { TezosToolkit } from '@taquito/taquito';\nimport { Tzip12Module } from '@taquito/tzip12';\n\nconst Tezos = new TezosToolkit('rpcUrl');\nTezos.addExtension(new Tzip12Module());\n\n")),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"Note that the ",Object(r.b)("inlineCode",{parentName:"em"},"Tzip16Module")," and ",Object(r.b)("inlineCode",{parentName:"em"},"Tzip12Module")," use the same ",Object(r.b)("inlineCode",{parentName:"em"},"MetadataProvider"),". If you have already set ",Object(r.b)("inlineCode",{parentName:"em"},"Tezos.addExtension(new Tzip16Module());"),", you can omit this step.")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"Use the ",Object(r.b)("inlineCode",{parentName:"strong"},"tzip12")," function to extend a contract abstraction"))),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'const contract = await Tezos.contract.at("contractAddress", tzip12)\n')),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"The compose function"),Object(r.b)("br",{parentName:"p"}),"\n","The contract abstraction can also be extended to a ",Object(r.b)("inlineCode",{parentName:"p"},"Tzip12ContractAbstraction")," and a ",Object(r.b)("inlineCode",{parentName:"p"},"Tzip16ContractAbstraction")," (at the same time) by using the ",Object(r.b)("inlineCode",{parentName:"p"},"compose")," function.\nThus, all methods of the ",Object(r.b)("inlineCode",{parentName:"p"},"ContractAbstraction"),", ",Object(r.b)("inlineCode",{parentName:"p"},"Tzip12ContractAbstraction")," and ",Object(r.b)("inlineCode",{parentName:"p"},"Tzip16ContractAbstraction")," classes will be available on the contract abstraction instance."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},"import { compose } from '@taquito/taquito';\n\nconst contract = await Tezos.contract.at('contractAddress', compose(tzip16, tzip12));\n\nawait contract.storage(); // ContractAbstraction method\nawait contract.tzip12().getTokenMetadata(1); // Tzip12ContractAbstraction method\nawait contract.tzip16().getMetadata(); // Tzip16ContractAbstraction method\n")),Object(r.b)("h2",{id:"get-the-token-metadata"},"Get the token metadata"),Object(r.b)("p",null,"There are two scenarios to obtain the metadata of a token:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"They can be obtained from executing an off-chain view named ",Object(r.b)("inlineCode",{parentName:"li"},"token_metadata")," present in the contract metadata"),Object(r.b)("li",{parentName:"ol"},"or, from a big map named ",Object(r.b)("inlineCode",{parentName:"li"},"token_metadata")," in the contract storage. ")),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"getTokenMetadata")," method of the ",Object(r.b)("inlineCode",{parentName:"p"},"Tzip12ContractAbstraction")," class will find the token metadata with precedence for the off-chain view, if there is one, as specified in the standard."),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"getTokenMetadata")," method returns an object matching this interface :"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"interface TokenMetadata {\n    token_id: number,\n    decimals: number\n    name?: string,\n    symbol?: string,\n}\n")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"If additional metadata values are provided for a token_id, they will also be returned."))),Object(r.b)("p",null,"Here is a flowchart that summarizes the logic perform internally when calling the ",Object(r.b)("inlineCode",{parentName:"p"},"getTokenMetadata")," method:"),Object(r.b)("p",null,Object(r.b)("img",{alt:"Flowchart",src:n(800).default})),Object(r.b)("p",null,"*",Object(r.b)("em",{parentName:"p"},"Note: If there is a URI in the token_info map and other keys/values in the map, all properties will be returned (properties fetched from the URI and properties found in the map). If the same key is found at the URI location and in the map token_info and that their value is different, precedence is accorded to the value from the URI.")),Object(r.b)("h3",{id:"example-where-the-token-metadata-are-obtained-from-an-off-chain-view-token_metadata"},"Example where the token metadata are obtained from an off-chain view ",Object(r.b)("inlineCode",{parentName:"h3"},"token_metadata")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:"live noInline",live:!0,noInline:!0},'// import { TezosToolkit, compose } from \'@taquito/taquito\';\n// import { Tzip12Module, tzip12 } from "@taquito/tzip12";\n// import { tzip16 } from "@taquito/tzip16";\n// const Tezos = new TezosToolkit(\'rpc_url\');\n\nTezos.addExtension(new Tzip12Module());\n\nconst contractAddress = "KT1QL1PrjmbEfRGb2dyLdc9eJ6MQpb83LQtb";\nconst tokenId = 1;\n\nTezos.contract.at(contractAddress, compose(tzip12, tzip16))\n.then(contract => {\n  println(`Fetching the token metadata for the token ID ${tokenId}...`);\n  return contract.tzip12().getTokenMetadata(tokenId);\n})\n.then (tokenMetadata => {\n  println(JSON.stringify(tokenMetadata, null, 2));\n})\n.catch(error => println(`Error: ${JSON.stringify(error, null, 2)}`));\n')),Object(r.b)("p",null,"The same result can also be obtained by calling the off-chain view ",Object(r.b)("inlineCode",{parentName:"p"},"token_metadata")," using the ",Object(r.b)("inlineCode",{parentName:"p"},"taquito-tzip16")," package:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:"live noInline",live:!0,noInline:!0},"// import { TezosToolkit } from '@taquito/taquito';\n// import { Tzip16Module, tzip16, bytes2Char } from \"@taquito/tzip16\";\n// const Tezos = new TezosToolkit('rpc_url');\n\nTezos.addExtension(new Tzip16Module());\n\nconst contractAddress = \"KT1QL1PrjmbEfRGb2dyLdc9eJ6MQpb83LQtb\";\nconst tokenId = 1;\n\nTezos.contract.at(contractAddress, tzip16)\n.then(contract => {\n  println(`Initialising the views for ${contractAddress}...`);\n  return contract.tzip16().metadataViews();\n})\n.then (views => {\n  return views['token_metadata']().executeView(tokenId)\n}).then (result => {\n  println('Result of the view token_metadata:');\n  println(`name: ${bytes2Char((Object.values(result)[1]).get('name'))}`);\n  println(`decimals: ${bytes2Char((Object.values(result)[1]).get('decimals'))}`);\n  println(`symbol: ${bytes2Char((Object.values(result)[1]).get('symbol'))}`);\n  println(`extra: ${bytes2Char((Object.values(result)[1]).get('extra'))}`);\n})\n.catch(error => println(`Error: ${JSON.stringify(error, null, 2)}`));\n")),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"Note that an off-chain view ",Object(r.b)("inlineCode",{parentName:"em"},"all-tokens")," should also be present in the contract metadata allowing the user to know with which token ID the ",Object(r.b)("inlineCode",{parentName:"em"},"token_metadata")," can be called.")),Object(r.b)("h3",{id:"example-where-the-token-metadata-are-found-in-the-big-map-token_metadata"},"Example where the token metadata are found in the big map ",Object(r.b)("inlineCode",{parentName:"h3"},"%token_metadata")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"To be ",Object(r.b)("a",{parentName:"p",href:"https://gitlab.com/tzip/tzip/-/blob/master/proposals/tzip-12/tzip-12.md#token-metadata-storage-access"},"Tzip-012 compliant"),", the type of the big map ",Object(r.b)("inlineCode",{parentName:"p"},"%token_metadata")," in the storage of the contract should match the following type:"),Object(r.b)(i.a,{defaultValue:"michelson",values:[{label:"Michelson",value:"michelson"},{label:"JSON Michelson",value:"jsonMichelson"}],mdxType:"Tabs"},Object(r.b)(c.a,{value:"michelson",mdxType:"TabItem"},Object(r.b)("pre",{parentName:"div"},Object(r.b)("code",{parentName:"pre"},"(big_map %token_metadata nat\n  (pair (nat %token_id)\n    (map %token_info string bytes)))\n")),"  "),Object(r.b)(c.a,{value:"jsonMichelson",mdxType:"TabItem"},Object(r.b)("pre",{parentName:"div"},Object(r.b)("code",{parentName:"pre"},"prim: 'big_map',\n    args: [\n        { prim: 'nat' }, \n        { prim: 'pair', args: [\n            { prim: 'nat' , annots: ['%token_id']}, \n            { prim: \"map\", args: [{ prim: 'string' }, { prim: 'bytes' }], annots: ['%token_info'] }] }],\n    annots: ['%token_metadata']\n")),"  ")),"  ",Object(r.b)("p",{parentName:"div"},"Otherwise, the token metadata won't be found by the ",Object(r.b)("inlineCode",{parentName:"p"},"getTokenMetadata")," method and a ",Object(r.b)("inlineCode",{parentName:"p"},"TokenMetadataNotFound")," error will be thrown."))),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:"live noInline",live:!0,noInline:!0},"// import { TezosToolkit } from '@taquito/taquito';\n// import { Tzip12Module, tzip12 } from \"@taquito/tzip12\";\n// const Tezos = new TezosToolkit('rpc_url');\n\nTezos.addExtension(new Tzip12Module());\n\nconst contractAddress = \"KT1NiajZ91LJwyJ5mnoRioXPqF9b4qM8st56\";\nconst tokenId = 1;\n\nTezos.contract.at(contractAddress, tzip12)\n.then(contract => {\n  println(`Fetching the token metadata for the token ID ${tokenId} of ${contractAddress}...`);\n  return contract.tzip12().getTokenMetadata(tokenId);\n})\n.then (tokenMetadata => {\n  println(JSON.stringify(tokenMetadata, null, 2));\n})\n.catch(error => println(`Error: ${JSON.stringify(error, null, 2)}`));\n")),Object(r.b)("h4",{id:"for-more-information-on-the-contracts-used-in-the-examples"},"For more information on the contracts used in the examples:"),Object(r.b)("p",null,"integration-tests/tzip12-token-metadata.spec.ts"))}b.isMDXComponent=!0},110:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return u}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createContext({}),p=function(e){var t=o.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},d=function(e){var t=p(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,u=d["".concat(i,".").concat(m)]||d[m]||b[m]||r;return n?o.a.createElement(u,c(c({ref:t},s),{},{components:n})):o.a.createElement(u,c({ref:t},s))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var s=2;s<r;s++)i[s]=n[s];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},117:function(e,t,n){"use strict";function a(e){var t,n,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(o&&(o+=" "),o+=n);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}t.a=function(){for(var e,t,n=0,o="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(o&&(o+=" "),o+=t);return o}},136:function(e,t,n){"use strict";var a=n(0),o=n(137);t.a=function(){var e=Object(a.useContext)(o.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},137:function(e,t,n){"use strict";var a=n(0),o=Object(a.createContext)(void 0);t.a=o},160:function(e,t,n){"use strict";var a=n(0),o=n.n(a),r=n(136),i=n(117),c=n(56),l=n.n(c),s=37,p=39;t.a=function(e){var t=e.lazy,n=e.block,c=e.defaultValue,d=e.values,b=e.groupId,m=e.className,u=Object(r.a)(),h=u.tabGroupChoices,f=u.setTabGroupChoices,O=Object(a.useState)(c),j=O[0],g=O[1],v=a.Children.toArray(e.children);if(null!=b){var k=h[b];null!=k&&k!==j&&d.some((function(e){return e.value===k}))&&g(k)}var N=function(e){g(e),null!=b&&f(b,e)},T=[];return o.a.createElement("div",null,o.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(i.a)("tabs",{"tabs--block":n},m)},d.map((function(e){var t=e.value,n=e.label;return o.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":j===t,className:Object(i.a)("tabs__item",l.a.tabItem,{"tabs__item--active":j===t}),key:t,ref:function(e){return T.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case p:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case s:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(T,e.target,e)},onFocus:function(){return N(t)},onClick:function(){N(t)}},n)}))),t?Object(a.cloneElement)(v.filter((function(e){return e.props.value===j}))[0],{className:"margin-vert--md"}):o.a.createElement("div",{className:"margin-vert--md"},v.map((function(e,t){return Object(a.cloneElement)(e,{key:t,hidden:e.props.value!==j})}))))}},161:function(e,t,n){"use strict";var a=n(0),o=n.n(a);t.a=function(e){var t=e.children,n=e.hidden,a=e.className;return o.a.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},800:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/FlowchartGetTokenMetadata-20cb73f35cf0d9eb1a8b7b0fa9c1953e.png"}}]);